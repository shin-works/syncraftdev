---
/**
 * Header â€” Navigation + Language Switcher
 */
import type { Lang } from '../i18n/translations';
import { languages } from '../i18n/translations';
import { t, getAlternateLangPath } from '../i18n/utils';

interface Props {
  lang: Lang;
  currentPath: string;
  alternateUrls?: Record<string, string>;
  activeNav?: string;
}

const { lang, currentPath, alternateUrls, activeNav } = Astro.props;

const homeHref = lang === 'ja' ? '/' : '/en/';
const blogHref = lang === 'ja' ? '/blog/' : '/en/blog/';

const navItems = [
  { key: 'nav.home' as const, href: `${homeHref}#hero`, id: 'hero' },
  { key: 'nav.product' as const, href: `${homeHref}#product`, id: 'product' },
  { key: 'nav.blog' as const, href: blogHref, id: 'blog' },
  { key: 'nav.contact' as const, href: `${homeHref}#contact`, id: 'contact' },
];

// Build language switch URLs
const langUrls: Record<string, string> = alternateUrls ?? {};
if (!langUrls.ja) langUrls.ja = getAlternateLangPath(currentPath, 'ja');
if (!langUrls.en) langUrls.en = getAlternateLangPath(currentPath, 'en');
---

<header>
  <div class="logo">
    <a href={homeHref}>
      <img src="/syncraft_logo_yoko_new.png" alt="SynCraft Logo" />
    </a>
  </div>
  <button class="menu-toggle" aria-label="Menu">
    <span></span>
    <span></span>
    <span></span>
  </button>
  <nav>
    <ul>
      {navItems.map((item) => (
        <li>
          <a
            href={item.href}
            class={activeNav === item.id ? 'active' : ''}
          >
            {t(lang, item.key)}
          </a>
        </li>
      ))}
      <li class="lang-dropdown">
        <button class="lang-toggle">
          <i class="fas fa-globe"></i>
          <span class="lang-current">{languages[lang]}</span>
        </button>
        <ul class="lang-menu">
          {Object.entries(languages).map(([code, name]) => (
            <li>
              <a
                href={langUrls[code] ?? '#'}
                class={code === lang ? 'active' : ''}
              >
                {name}
              </a>
            </li>
          ))}
        </ul>
      </li>
    </ul>
  </nav>
</header>

<script>
  // Header scroll effect
  const header = document.querySelector('header');
  if (header) {
    window.addEventListener('scroll', () => {
      header.classList.toggle('scrolled', window.scrollY > 50);
    });
  }

  // Mobile menu toggle
  const menuToggle = document.querySelector('.menu-toggle');
  const nav = document.querySelector('nav');
  if (menuToggle && nav) {
    menuToggle.addEventListener('click', () => {
      nav.classList.toggle('active');
      menuToggle.classList.toggle('active');
    });
  }

  // Smooth scrolling for same-page anchors
  document.querySelectorAll('a[href^="#"]').forEach((anchor) => {
    anchor.addEventListener('click', (e) => {
      const href = anchor.getAttribute('href');
      if (!href) return;
      const target = document.querySelector(href);
      if (target) {
        e.preventDefault();
        nav?.classList.remove('active');
        menuToggle?.classList.remove('active');
        target.scrollIntoView({ behavior: 'smooth' });
      }
    });
  });

  // Language dropdown open/close
  document.querySelectorAll('.lang-toggle').forEach((btn) => {
    btn.addEventListener('click', (e) => {
      e.stopPropagation();
      btn.closest('.lang-dropdown')?.classList.toggle('open');
    });
  });

  document.addEventListener('click', () => {
    document.querySelectorAll('.lang-dropdown').forEach((d) => {
      d.classList.remove('open');
    });
  });
</script>
